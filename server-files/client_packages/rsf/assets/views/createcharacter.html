<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/base.css">
    <link rel="stylesheet" type="text/css" href="../css/schriftarten.css">
    <link rel="stylesheet" type="text/css" href="../css/fontawesome.min.css">
	<title>Einreiseformular</title>
</head>

<body onLoad="onLoad()">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="logincontainer">
                    <header><div class="logo"></div></header>
                    <div class="body">
						<div class="column">
							<div class="container">
								<div class="row">
									<div class="col-12 mb-4">
										<p class="text-center h4"><u>Antrag auf Erteilung eines Visums</u></p>
									</div>
									<div class="col-12">
										<div class="alert alert-danger d-none">
											<p id="err-1" class="d-none mb-0">Bitte fülle alle Felder ordnungsgemäß aus.</p>
											<p id="err-2" class="d-none mb-0">Dieser Charakter ist bereits eingereist.</p>
											<p id="err-3" class="d-none mb-0">Du hast bereits alle Charaktere erstellt.</p>
										</div>
									</div>
									<div class="col-6">
										<div class="form-group pl-2 pr-2">
											<label for="Nachname" class="font-weight-bold">1. Nachname</label>
											<input type="text" class="form-control" id="Nachname">
										</div>
									</div>
									<div class="col-6">
										<div class="form-group pl-2 pr-2">
											<label for="Vorname" class="font-weight-bold">2. Vorname</label>
											<input type="text" class="form-control" id="Vorname">
										</div>
									</div>
									<div class="col-6">
										<div class="form-group pl-2 pr-2">
											<label for="Geburtsdatum" class="font-weight-bold">3. Geburtsdatum</label>
											<input type="text" class="form-control" id="Geburtsdatum">
										</div>
									</div>
									<div class="col-6">
										<div class="form-group pl-2 pr-2">
											<label for="Geburtsort" class="font-weight-bold">4. Geburtsort</label>
											<input type="text" class="form-control" id="Geburtsort">
										</div>
									</div>
									<div class="col-6">
										<div class="form-group pl-2 pr-2">
											<label for="Staatsangehoerigkeit" class="font-weight-bold">5. Staatsangehörigkeit</label>
											<input type="text" class="form-control" id="Staatsangehoerigkeit">
										</div>
									</div>
									<div class="col-6">
										<div class="form-group pl-2 pr-2">
										<label class="font-weight-bold">6. Geschlecht</label><br/>
											<div class="mt-2 form-check form-check-inline">
												<input class="form-check-input" type="radio" id="GeschlechtMann" name="Geschlecht" value="0">
												<label class="form-check-label" for="GeschlechtMann">Männlich</label>
											</div>
											<div class="form-check form-check-inline">
												<input class="form-check-input" type="radio" id="GeschlechtFrau" name="Geschlecht" value="1">
												<label class="form-check-label" for="GeschlechtFrau">Weiblich</label>
											</div>
										</div>
									</div>
									<div class="col-6">
										<div class="form-group pl-2 pr-2">
										<label class="font-weight-bold">7. Familienstand</label><br/>
											<div class="form-check form-check-inline">
												<input class="form-check-input" type="radio" id="FamilienstandLedig" name="Familienstand" value="0">
												<label class="form-check-label" for="FamilienstandLedig">ledig</label>
											</div>
											<div class="form-check form-check-inline">
												<input class="form-check-input" type="radio" id="FamilienstandVerheiratet" name="Familienstand" value="1">
												<label class="form-check-label" for="FamilienstandVerheiratet">verheiratet</label>
											</div>
											<div class="form-check form-check-inline">
												<input class="form-check-input" type="radio" id="FamilienstandGetrennt" name="Familienstand" value="2">
												<label class="form-check-label" for="FamilienstandGetrennt">getrennt</label>
											</div>
											<div class="form-check form-check-inline">
												<input class="form-check-input" type="radio" id="FamilienstandGeschieden" name="Familienstand" value="3">
												<label class="form-check-label" for="FamilienstandGeschieden">geschieden</label>
											</div>
											<div class="form-check form-check-inline">
												<input class="form-check-input" type="radio" id="FamilienstandVerwitwet" name="Familienstand" value="4">
												<label class="form-check-label" for="FamilienstandVerwitwet">verwitwet</label>
											</div>
										</div>
									</div>
									<div class="col-6">
										<div class="form-group pl-2 pr-2">
											<label for="Ausstellungsdatum" class="font-weight-bold">8. Ausstellungsdatum</label>
											<input type="text" class="form-control" id="Ausstellungsdatum" readonly>
										</div>
									</div>
									<div class="col-6 mt-4">
										<div class="form-group pl-2 pr-2">
											<label>Ort, Datum</label>
											<p id="Ort" class="h5"></p>
										</div>
									</div>
									<div class="col-6 mt-4">
										<div class="form-group pl-2 pr-2 height-80">
											<label>Unterschrift</label>
											<div id="Unterschrift" class="h4 Unterschrift"></div>
											<p class="d-none" id="UnterschriftHidden"></p>
										</div>
									</div>
									<div class="col-12 mt-4 text-center">
										<button type="Submit" onclick="UnterschreibenClick();" class="btn btn-success">Einreisen</button>
									</div>
								</div>
							</div>
						</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../js/jquery.min.js"></script>
	<script>
		var i = 0;
		var txt = null;
		var params = null;
		var schriftart = 1;
		function HandleError(err) {
			$(".alert.alert-danger > p").addClass("d-none");
			$(".alert.alert-danger").removeClass("d-none");
			$(`#err-${err}`).removeClass("d-none");
			$(".btn.btn-success").attr("disabled", false);
			$("#UnterschriftHidden").text("");
			$("#Unterschrift").text("");
		}

		function UnterschreibenClick() {
			$(".alert.alert-danger > p").addClass("d-none");
			if($("#Vorname").val().length === 0 || $("#Nachname").val().length === 0 || $("#Geburtsdatum").val().length === 0 || $("#Geburtsort").val().length === 0 || $("#Staatsangehoerigkeit").val().length === 0 || !$('input[name=Geschlecht]').is(':checked') || !$('input[name=Familienstand]').is(':checked') || Number.isNaN(Date.parse($("#Geburtsdatum").val()))) {
				$(".alert.alert-danger").removeClass("d-none");
				$("#err-1").removeClass("d-none");
				return false;
			}
			$(".alert.alert-danger").addClass("d-none");
			i = 0;
			$("#UnterschriftHidden").text("");
			$("#Unterschrift").text("");
			$("#UnterschriftHidden").text(`${$("#Vorname").val()[0].toUpperCase()}.${$("#Nachname").val()[0].toUpperCase()}${$("#Nachname").val().slice(1).toLowerCase()}`).text();
			$(".btn.btn-success").attr("disabled", true);

			params = {
				Vorname: $("#Vorname").val(),
				Nachname: $("#Nachname").val(),
				Geburtsdatum: $("#Geburtsdatum").val(),
				Geburtsort: $("#Geburtsort").val(),
				Staatsangehoerigkeit: $("#Staatsangehoerigkeit").val(),
				Geschlecht: $('input[name=Geschlecht]:checked').val() == 1,
				Familienstand: $('input[name=Familienstand]:checked').val(),
				Schriftart: schriftart
			};
			Unterschreiben();
		}
		
		function Unterschreiben() {
			txt = $('#UnterschriftHidden').text();
			if (i < txt.length) {
				if(i > 12) {
					i = txt.length;
					return;
				}
				$("#Unterschrift").text($("#Unterschrift").text()+txt.charAt(i));
				i++;
				setTimeout(Unterschreiben, 80);
			} else {
				setTimeout(() => { mp.trigger("CallServerEvent", "CreateCharakter", JSON.stringify(params)); }, 1000);
			}
		}
		
	
	
		function onLoad() {
			const monthNames = ["Januar", "Februar", "März", "April", "Mai", "Juni",
				"Juli", "August", "September", "Oktober", "November", "Dezember"
			];
			var datum = new Date();
				$("#Ausstellungsdatum").val(`${datum.getDate() < 10 ? `0${datum.getDate()}` : datum.getDate()}.${datum.getMonth()+1 < 10 ? `0${datum.getMonth()+1}` : datum.getMonth()+1}.${datum.getFullYear()}`);
				$('#Ort').text(`Los Santos, ${datum.getDate() < 10 ? `0${datum.getDate()}` : datum.getDate()}.${monthNames[datum.getMonth()]}.${datum.getFullYear()}`);
			schriftart = Math.floor(Math.random()*7)+1;
			$("#Unterschrift").addClass(`schriftart${schriftart}`);
		}
	</script>
</body>
</html>